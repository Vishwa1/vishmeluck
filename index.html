<!DOCTYPE html>
<html>
<head>
  <title>Vishmeluck – Live Sector Drilldown</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="p-4 max-w-6xl mx-auto">

<h1 class="text-2xl font-bold mb-4">
  Vishmeluck – Equity & Stock Options Dashboard
</h1>

<div class="border rounded-2xl shadow p-4 mb-6">
<h2 class="font-semibold mb-3">Click a Sector</h2>
<div id="sectorGrid" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
</div>

<div id="drill" class="hidden">
<h2 class="font-bold mb-2" id="sectorTitle"></h2>

<div class="grid md:grid-cols-2 gap-4">

<div class="border rounded-2xl shadow p-4">
<h3 class="font-semibold mb-2">Top 10 Gainers</h3>
<div id="gainers">Loading...</div>
</div>

<div class="border rounded-2xl shadow p-4">
<h3 class="font-semibold mb-2">Top 10 Losers</h3>
<div id="losers">Loading...</div>
</div>

</div>
</div>

<script>

const sectors = [
  { name: "IT", v: 1.2 },
  { name: "BANK", v: -0.6 },
  { name: "AUTO", v: 0.9 },
  { name: "PHARMA", v: 0.4 }
];

const sectorStocks = {
  "IT": ["TCS.NS","INFY.NS","WIPRO.NS","HCLTECH.NS","TECHM.NS","LTIM.NS","PERSISTENT.NS","COFORGE.NS"],
  "BANK": ["HDFCBANK.NS","ICICIBANK.NS","SBIN.NS","AXISBANK.NS","KOTAKBANK.NS","INDUSINDBK.NS","FEDERALBNK.NS"],
  "AUTO": ["TATAMOTORS.NS","MARUTI.NS","M&M.NS","HEROMOTOCO.NS","BAJAJ-AUTO.NS"],
  "PHARMA": ["SUNPHARMA.NS","DRREDDY.NS","CIPLA.NS","DIVISLAB.NS","LUPIN.NS"]
};

function style(v){
  if(v>1) return 'bg-green-200';
  if(v>0) return 'bg-green-100';
  if(v>-1) return 'bg-red-100';
  return 'bg-red-200';
}

const grid=document.getElementById('sectorGrid');

sectors.forEach(s=>{
  const d=document.createElement('div');
  d.className=`p-4 rounded-xl text-center cursor-pointer ${style(s.v)}`;
  d.innerHTML=`<div class=\"font-semibold\">${s.name}</div><div class=\"text-sm\">${s.v}%</div>`;
  d.onclick=()=>openSector(s.name);
  grid.appendChild(d);
});

async function fetchQuotes(symbols){
  const url=`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbols.join(',')}`;
  const r=await fetch(url);
  const j=await r.json();
  return j.quoteResponse.result.map(x=>({
    symbol:x.symbol.replace('.NS',''),
    price:x.regularMarketPrice,
    change:x.regularMarketChangePercent
  }));
}

async function openSector(name){
  document.getElementById('drill').classList.remove('hidden');
  document.getElementById('sectorTitle').innerText=name+" Sector";

  const list=sectorStocks[name]||[];
  const data=await fetchQuotes(list);

  const sorted=[...data].sort((a,b)=>b.change-a.change);

  const gain=sorted.slice(0,10);
  const lose=[...sorted].reverse().slice(0,10);

  document.getElementById('gainers').innerHTML=
    gain.map(x=>`<div class='py-1 flex justify-between'>
      <span>${x.symbol}</span>
      <span class='text-green-700'>${x.change.toFixed(2)}%</span>
    </div>`).join('');

  document.getElementById('losers').innerHTML=
    lose.map(x=>`<div class='py-1 flex justify-between'>
      <span>${x.symbol}</span>
      <span class='text-red-700'>${x.change.toFixed(2)}%</span>
    </div>`).join('');
}

</script>

</body>
</html>
